rules_version = '2';

// Firebase Storage Security Rules - Multi-Tenant
service firebase.storage {
  match /b/{bucket}/o {

    // ============================================================================
    // BRANDING IMAGES
    // ============================================================================

    /**
     * Branding images (logo and hero) for landing pages
     * Path: tenants/{tenantId}/branding/{imageFile}
     * - Public read: Landing pages must be accessible to everyone
     * - Admin write: Only admins can upload branding images
     * - Size limit: 5MB per image
     * - Type: Only image files allowed
     */
    match /tenants/{tenantId}/branding/{imageFile} {
      // Public read for landing pages
      allow read: if true;

      // Admin write with validation
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024 // Max 5MB
                   && request.resource.contentType.matches('image/.*'); // Only images
    }

    // ============================================================================
    // PRODUCT IMAGES
    // ============================================================================

    /**
     * Product images uploaded by admins
     * Path: tenants/{tenantId}/product-images/{imageFile}
     * - Authenticated users can read
     * - Admin/staff can write
     */
    match /tenants/{tenantId}/product-images/{imageFile} {
      allow read: if request.auth != null;
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024 // Max 5MB
                   && request.resource.contentType.matches('image/.*');
    }

    // ============================================================================
    // CATCH-ALL (DENY BY DEFAULT)
    // ============================================================================

    /**
     * Deny all other access by default
     * Explicitly list allowed paths above
     */
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
